<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Results - The Great Spring Tip Off</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#fbbf24">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <style>
    .gradient-text {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .glass-effect {
      background: rgba(17, 24, 39, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }
    .card {
      background: linear-gradient(145deg, rgba(31, 41, 55, 0.9), rgba(17, 24, 39, 0.9));
      border: 1px solid rgba(75, 85, 99, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
      border-color: rgba(251, 191, 36, 0.3);
    }
    .result-card { transition: all .3s ease; cursor:pointer; }
    .result-card.correct { background: linear-gradient(145deg, rgba(22, 163, 74, 0.15), rgba(34, 197, 94, 0.1)); border: 1px solid rgba(34, 197, 94, 0.3); }
    .result-card.incorrect { background: linear-gradient(145deg, rgba(220, 38, 38, 0.15), rgba(239, 68, 68, 0.1)); border: 1px solid rgba(239, 68, 68, 0.3); }
    .modal { background: rgba(0,0,0,0.9); }
    .modal-content {
      background: linear-gradient(145deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
      border: 1px solid rgba(75, 85, 99, 0.3);
    }
    .filter-select {
      background: linear-gradient(145deg, rgba(31, 41, 55, 0.9), rgba(17, 24, 39, 0.9));
      border: 1px solid rgba(75, 85, 99, 0.4);
      transition: all 0.2s ease;
    }
    .filter-select:focus {
      border-color: rgba(251, 191, 36, 0.5);
      box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 flex flex-col min-h-screen">
  <!-- Navigation -->
  <nav class="sticky top-0 z-50 glass-effect">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center">
          <img src="images/logo.png" alt="Logo" class="h-8 w-8 mr-2" style="object-fit:contain;">
          <h1 class="text-xl font-bold gradient-text">The Great Spring Tip Off</h1>
        </div>
        <div class="flex items-center space-x-4">
          <button class="md:hidden" onclick="toggleMenu()">
            <i data-feather="menu" class="h-6 w-6 text-gray-200"></i>
          </button>
          <div class="hidden md:flex space-x-6">
            <a href="dark.html" class="text-gray-300 hover:text-yellow-400 transition">Home</a>
            <a href="tipdark.html" class="text-gray-300 hover:text-yellow-400 transition">Tip Now</a>
            <a href="leaderboarddark.html" class="text-gray-300 hover:text-yellow-400 transition">Leaderboard</a>
            <a href="resultsdark.html" class="text-gray-300 hover:text-yellow-400 transition">Results</a>
            <a href="podcastdark.html" class="text-gray-300 hover:text-yellow-400 transition">Podcast</a>
            <a href="faqdark.html" class="text-gray-300 hover:text-yellow-400 transition">FAQ</a>
            <a href="prizesdark.html" class="text-gray-300 hover:text-yellow-400 transition">Prizes</a>
            <a href="profiledark.html" class="text-gray-300 hover:text-yellow-400 transition">Profile</a>
          </div>
        </div>
      </div>
    </div>
    <div id="mobileMenu" class="hidden md:hidden glass-effect px-4 py-2 space-y-2">
      <a href="dark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Home</a>
      <a href="tipdark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Tip Now</a>
      <a href="leaderboarddark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Leaderboard</a>
      <a href="resultsdark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Results</a>
      <a href="podcastdark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Podcast</a>
      <a href="faqdark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">FAQ</a>
      <a href="prizesdark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Prizes</a>
      <a href="profiledark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Profile</a>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow">
    <section class="mb-10" data-aos="fade-up">
      <div class="card rounded-2xl shadow-2xl p-8 md:p-10 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-yellow-600/10 to-transparent rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-amber-600/10 to-transparent rounded-full blur-3xl"></div>
        <div class="relative z-10">
          <h1 class="text-3xl md:text-4xl font-bold mb-2 gradient-text">Your Results</h1>
          <p class="text-gray-300">Review your tips and race outcomes</p>
        </div>
      </div>
    </section>

    <!-- Week Navigation -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3 mb-6" data-aos="fade-up">
      <div class="card rounded-xl px-4 py-3 flex items-center justify-between gap-3 w-full sm:w-auto">
        <button id="week-prev" class="px-3 py-2 rounded-lg bg-gray-800 text-gray-300 hover:text-yellow-400 hover:bg-gray-700 transition" aria-label="Previous week">
          <i data-feather="chevron-left" class="h-4 w-4"></i>
        </button>
        <div class="text-sm text-gray-300">
          <span id="week-label" class="font-semibold text-gray-100">Week</span>
        </div>
        <button id="week-next" class="px-3 py-2 rounded-lg bg-gray-800 text-gray-300 hover:text-yellow-400 hover:bg-gray-700 transition" aria-label="Next week">
          <i data-feather="chevron-right" class="h-4 w-4"></i>
        </button>
      </div>
    </div>

    <!-- Filter & Sort controls -->
    <div class="flex flex-col sm:flex-row gap-3 mb-8" data-aos="fade-up">
      <select id="sort-date" class="filter-select px-4 py-2.5 rounded-lg text-gray-100 flex-1">
        <option value="newest">Date: Newest â†’ Oldest</option>
        <option value="oldest">Date: Oldest â†’ Newest</option>
      </select>
      <select id="filter-win" class="filter-select px-4 py-2.5 rounded-lg text-gray-100 flex-1">
        <option value="all">All Results</option>
        <option value="wins">Wins Only</option>
        <option value="losses">Losses Only</option>
      </select>
      <select id="filter-venue" class="filter-select px-4 py-2.5 rounded-lg text-gray-100 flex-1">
        <option value="all">All Venues</option>
        <option value="flemington">Flemington</option>
        <option value="caulfield">Caulfield</option>
        <option value="randwick">Randwick</option>
        <option value="rosehill">Rosehill</option>
        <option value="valley">Valley</option>
      </select>
    </div>

    <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5" data-aos="fade-up"></div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-950 border-t border-gray-800 text-gray-400 py-10 mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex flex-col items-center md:items-start">
          <div class="flex items-center mb-2">
            <img src="images/logo.png" alt="Logo" class="h-6 w-6 mr-2" style="object-fit: contain;" />
            <span class="font-semibold text-gray-300">The Mock Sports</span>
          </div>
          <p class="text-sm text-gray-500">&copy; 2026 All rights reserved.</p>
        </div>
        <div class="flex space-x-6">
          <a href="https://x.com/themocksports" target="_blank" rel="noopener noreferrer" class="hover:text-yellow-400 transition-colors duration-200" aria-label="Follow us on X">
            <i data-feather="twitter" class="h-5 w-5"></i>
          </a>
          <a href="https://facebook.com/TheMockSports" target="_blank" rel="noopener noreferrer" class="hover:text-yellow-400 transition-colors duration-200" aria-label="Follow us on Facebook">
            <i data-feather="facebook" class="h-5 w-5"></i>
          </a>
          <a href="https://instagram.com/themocksports" target="_blank" rel="noopener noreferrer" class="hover:text-yellow-400 transition-colors duration-200" aria-label="Follow us on Instagram">
            <i data-feather="instagram" class="h-5 w-5"></i>
          </a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Modal -->
  <div id="result-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal" onclick="if(event.target.id==='result-modal') closeModal()">
    <div class="modal-content rounded-2xl shadow-2xl max-w-2xl w-full mx-4 p-6 md:p-8 relative">
      <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-yellow-400 transition text-2xl" aria-label="Close">&times;</button>
      <h3 id="modal-race-name" class="text-2xl md:text-3xl font-bold mb-6 gradient-text"></h3>
      <div id="modal-race-details" class="text-gray-200 space-y-4"></div>
    </div>
  </div>

  <!-- Loading -->
  <div id="loading-overlay" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">
    <div class="text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-4 border-yellow-500 border-t-transparent mx-auto"></div>
      <p class="mt-4 text-yellow-400 font-semibold">Loading Resultsâ€¦</p>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, collection, getDocs, getDoc, doc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    const { DateTime } = luxon;

    const firebaseConfig = {
      apiKey:"AIzaSyCrgNrA4n62hg1U3ujZMRCOYcbLcwT77ZA",
      authDomain:"tmstipping.firebaseapp.com",
      projectId:"tmstipping",
      storageBucket:"tmstipping.appspot.com",
      messagingSenderId:"401677933527",
      appId:"1:401677933527:web:2312ad4ef69aef6551c992"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    let user=null, allResults=[], countdownTimer=null;
    let weekStarts=[], currentWeekIndex=0;
    const RESULTS_CACHE_KEY = "tmstipping:resultsCache";

    function getCachedResults() {
      try {
        const raw = localStorage.getItem(RESULTS_CACHE_KEY);
        if (!raw) return null;
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed?.entries)) return null;
        return parsed.entries;
      } catch (error) {
        localStorage.removeItem(RESULTS_CACHE_KEY);
        return null;
      }
    }

    function saveCachedResults(entries) {
      localStorage.setItem(RESULTS_CACHE_KEY, JSON.stringify({ entries, updatedAt: Date.now() }));
    }

    function showLoading(){document.getElementById("loading-overlay").classList.remove("hidden");}
    function hideLoading(){document.getElementById("loading-overlay").classList.add("hidden");}
    function openModal(race, detailsHtml){
      document.getElementById("modal-race-name").textContent = race.name;
      document.getElementById("modal-race-details").innerHTML = detailsHtml;
      document.getElementById("result-modal").classList.remove("hidden");
    }
    window.closeModal=()=>document.getElementById("result-modal").classList.add("hidden");

    const cached = getCachedResults();
    let hasInitialCache = false;
    if (cached) {
      allResults = cached;
      renderResults();
      hasInitialCache = true;
    }

    onAuthStateChanged(auth, async (_user)=>{
      if(!_user){window.location.href="login.html"; return;}
      user=_user; await loadAllResults();
    });

    function formatCountdown(targetMillis) {
      const diff = targetMillis - DateTime.now().toMillis();
      if (diff <= 0) return "Jumped";
      const d = Math.floor(diff / 86400000);
      const h = Math.floor(diff / 3600000) % 24;
      const m = Math.floor(diff / 60000) % 60;
      const s = Math.floor(diff / 1000) % 60;
      let text = "Jumps in: ";
      if (d > 0) text += `${d}d `;
      if (h > 0 || d > 0) text += `${h}h `;
      text += `${m}m ${s}s`;
      return text;
    }

    function startCountdownRefresh() {
      if (countdownTimer) clearInterval(countdownTimer);
      countdownTimer = setInterval(() => {
        document.querySelectorAll("[data-jump-millis]").forEach((el) => {
          const target = Number(el.getAttribute("data-jump-millis"));
          if (Number.isNaN(target)) return;
          el.textContent = formatCountdown(target);
        });
      }, 1000);
    }

    async function loadAllResults() {
      if (!hasInitialCache) showLoading();
      try {
        allResults=[];
        const [racesSnap, tipsSnap, resultsSnap] = await Promise.all([
          getDocs(collection(db,"races")),
          getDocs(collection(db,"tips")),
          getDocs(collection(db,"results"))
        ]);

        const userTips={};
        tipsSnap.forEach(d=>{const t=d.data(); if(t.userId===user.uid) userTips[t.raceId]=t;});

        const resultsMap={};
        resultsSnap.forEach(d=>{resultsMap[d.id]=d.data();});

        for(const docSnap of racesSnap.docs){
          const race={id:docSnap.id,...docSnap.data()};
          const rd=resultsMap[race.id];
          const tip=userTips[race.id];
          if (!rd && !tip) continue;

          const dt = race.date && race.time
            ? DateTime.fromISO(`${race.date}T${race.time}`, { zone: "Australia/Sydney" })
            : race.date
              ? DateTime.fromISO(race.date)
              : null;
          const dtStr = dt ? dt.toFormat("dd/LL/yyyy") : "";
          const dtMillis = dt ? dt.toMillis() : 0;

          let horseId=tip?tip.horseId:null;
          let joker=tip?tip.joker===true:false;
          if(tip && race.horses && horseId && race.horses[horseId]?.scratched){
            const sub=Object.entries(race.horses).find(([_,h])=>h.substitute);
            if(sub) horseId=sub[0];
          }

          const tippedHorse=horseId?race.horses?.[horseId]:null;
          const tippedName=tippedHorse?.name||"";

          let correct=false, pts=0;
          let winnerName="", place1Name="", place2Name="";
          if (rd) {
            const winnerPoints=parseFloat(rd.points)||0;
            const place1Points=parseFloat(rd.place1Points)||0;
            const place2Points=parseFloat(rd.place2Points)||0;
            const winnerHorse=race.horses?.[rd.winningHorseId];
            const place1Horse=race.horses?.[rd.place1HorseId];
            const place2Horse=race.horses?.[rd.place2HorseId];
            winnerName=winnerHorse?.name||"";
            place1Name=place1Horse?.name||"";
            place2Name=place2Horse?.name||"";

            if(horseId===rd.winningHorseId){correct=true; pts=winnerPoints;}
            else if(horseId===rd.place1HorseId){correct=true; pts=place1Points;}
            else if(horseId===rd.place2HorseId){correct=true; pts=place2Points;}
            if(correct && joker && pts>0) pts*=2;
          }

          allResults.push({
            race,
            rd,
            correct,
            pts,
            joker,
            tippedName,
            winnerName,
            place1Name,
            place2Name,
            dtStr,
            dtMillis
          });
        }
        renderResults();
        saveCachedResults(allResults);
        setupWeekNavigation(allResults);
      } catch (error) {
        console.error('Error loading results:', error);
      } finally {
        hideLoading();
      }
    }

    function renderResults(){
      const container=document.getElementById("results-container");
      container.innerHTML="";
      let results=[...allResults];

      if (weekStarts.length > 0) {
        const weekStartMillis = weekStarts[currentWeekIndex];
        const weekEndMillis = DateTime.fromMillis(weekStartMillis).plus({ days: 7 }).toMillis();
        results = results.filter((r) => r.dtMillis >= weekStartMillis && r.dtMillis < weekEndMillis);
      }

      // Apply filters
      const winFilter=document.getElementById("filter-win").value;
      if(winFilter==="wins") results=results.filter(r=>r.correct);
      if(winFilter==="losses") results=results.filter(r=>r.rd && !r.correct);

      const venueFilter=document.getElementById("filter-venue").value;
      if(venueFilter!=="all") results=results.filter(r=>r.race.name?.toLowerCase().includes(venueFilter));

      // Apply sorting
      const sort=document.getElementById("sort-date").value;
      results.sort((a,b)=>{
        if(!a.dtMillis||!b.dtMillis) return 0;
        return sort==="newest" ? b.dtMillis-a.dtMillis : a.dtMillis-b.dtMillis;
      });

      // Show empty state
      if(results.length===0){
        const emptyDiv=document.createElement("div");
        emptyDiv.className="col-span-full card rounded-xl p-12 text-center";
        emptyDiv.innerHTML=`
          <div class="max-w-sm mx-auto">
            <div class="w-16 h-16 mx-auto mb-4 bg-gray-800 rounded-full flex items-center justify-center">
              <i data-feather="flag" class="h-8 w-8 text-gray-500"></i>
            </div>
            <h3 class="text-lg font-semibold text-gray-300 mb-2">No Results Yet</h3>
            <p class="text-gray-500 text-sm">Check back after races are completed.</p>
          </div>
        `;
        container.appendChild(emptyDiv);
        feather.replace();

        return;
      }

      // Render
      results.forEach(({race,rd,correct,pts,joker,tippedName,winnerName,place1Name,place2Name,dtStr})=>{
        const card=document.createElement("div");
        const cardStateClass = rd ? (correct?"correct":"incorrect") : "";
        card.className=`p-6 rounded-xl shadow-lg result-card ${cardStateClass}`;
        const jumpMillis = race.date && race.time
          ? DateTime.fromISO(`${race.date}T${race.time}`, { zone: "Australia/Sydney" }).toMillis()
          : null;
        const countdownHtml = jumpMillis
          ? `<p class="text-sm text-yellow-400 font-semibold" data-jump-millis="${jumpMillis}">${formatCountdown(jumpMillis)}</p>`
          : "";
        card.innerHTML=`
          <h3 class="text-xl font-bold mb-1">${race.name}</h3>
          <p class="text-sm text-gray-400 mb-2">${dtStr}</p>
          <p class="text-gray-300">
            ${rd ? (correct?`You earned <span class="text-green-500 font-bold">+${pts.toFixed(2)}</span>`:"No points earned") : (tippedName ? `Tip placed: <span class="text-gray-100 font-semibold">${tippedName}</span>` : "Tip placed")}
          </p>
          ${rd ? "" : countdownHtml}
        `;
        card.onclick=()=>{
          const modalContent = `
            <div class="space-y-4">
              <div class="bg-gradient-to-r from-blue-600/20 to-blue-500/10 rounded-lg p-4 border border-blue-500/30">
                <p class="text-xs text-blue-300 mb-1">Your Tip</p>
                <p class="text-xl font-bold text-blue-200">${tippedName||"No tip placed"}</p>
              </div>
              ${rd ? `
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                  <div class="bg-black/30 rounded-lg p-3 ${tippedName===winnerName?'border-2 border-green-500/50 bg-green-600/10':''}">
                    <p class="text-xs text-gray-400 mb-1">ðŸ¥‡ 1st Place</p>
                    <p class="font-semibold text-gray-200">${winnerName}</p>
                  </div>
                  <div class="bg-black/30 rounded-lg p-3 ${tippedName===place1Name?'border-2 border-green-500/50 bg-green-600/10':''}">
                    <p class="text-xs text-gray-400 mb-1">ðŸ¥ˆ 2nd Place</p>
                    <p class="font-semibold text-gray-200">${place1Name}</p>
                  </div>
                  <div class="bg-black/30 rounded-lg p-3 ${tippedName===place2Name?'border-2 border-green-500/50 bg-green-600/10':''}">
                    <p class="text-xs text-gray-400 mb-1">ðŸ¥‰ 3rd Place</p>
                    <p class="font-semibold text-gray-200">${place2Name}</p>
                  </div>
                </div>
                <div class="pt-4 border-t border-gray-700/50">
                  ${correct?`<p class="text-3xl font-bold text-green-400">âœ“ +${pts.toFixed(2)}</p>`:`<p class="text-lg font-semibold text-red-400">âœ— No points</p>`}
                </div>
                ${joker && correct?`<p class="mt-2 bg-purple-600/30 text-purple-300 px-3 py-2 rounded border border-purple-500/30 text-sm font-semibold">ðŸ”¥ JOKER BONUS - Points Doubled!</p>`:``}
              ` : `
                <div class="bg-gray-800/60 rounded-lg p-4 border border-gray-700">
                  <p class="text-xs text-gray-400 mb-2">Countdown to jump</p>
                  ${jumpMillis ? `<p class="text-lg font-semibold text-yellow-400" data-jump-millis="${jumpMillis}">${formatCountdown(jumpMillis)}</p>` : `<p class="text-sm text-gray-400">Jump time unavailable</p>`}
                </div>
              `}
            </div>
          `;
          openModal(race, modalContent);
          startCountdownRefresh();
        };
        container.appendChild(card);
      });
      startCountdownRefresh();
    }

    function setupWeekNavigation(entries) {
      const starts = new Set();
      entries.forEach((entry) => {
        if (!entry.dtMillis) return;
        const weekStart = DateTime.fromMillis(entry.dtMillis).startOf("week").toMillis();
        starts.add(weekStart);
      });
      weekStarts = Array.from(starts).sort((a, b) => a - b);
      currentWeekIndex = Math.max(weekStarts.length - 1, 0);
      updateWeekLabel();
      bindWeekButtons();
      renderResults();
    }

    function updateWeekLabel() {
      const labelEl = document.getElementById("week-label");
      if (!weekStarts.length) {
        labelEl.textContent = "No dated races";
        return;
      }
      const start = DateTime.fromMillis(weekStarts[currentWeekIndex]);
      const end = start.plus({ days: 6 });
      labelEl.textContent = `${start.toFormat("LLL d")} - ${end.toFormat("LLL d")}`;

      document.getElementById("week-prev").disabled = currentWeekIndex === 0;
      document.getElementById("week-next").disabled = currentWeekIndex === weekStarts.length - 1;
      document.getElementById("week-prev").classList.toggle("opacity-40", currentWeekIndex === 0);
      document.getElementById("week-next").classList.toggle("opacity-40", currentWeekIndex === weekStarts.length - 1);
    }

    function bindWeekButtons() {
      const prevBtn = document.getElementById("week-prev");
      const nextBtn = document.getElementById("week-next");

      prevBtn.onclick = () => {
        if (currentWeekIndex === 0) return;
        currentWeekIndex -= 1;
        updateWeekLabel();
        renderResults();
      };

      nextBtn.onclick = () => {
        if (currentWeekIndex >= weekStarts.length - 1) return;
        currentWeekIndex += 1;
        updateWeekLabel();
        renderResults();
      };
    }

    // Hook up filter controls
    ["sort-date","filter-win","filter-venue"].forEach(id=>{
      document.getElementById(id).onchange=renderResults;
    });

    AOS.init({duration:1000,once:true}); feather.replace();
    window.toggleMenu=()=>document.getElementById("mobileMenu").classList.toggle("hidden");
  </script>
</body>
</html>
