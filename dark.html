<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Great Spring Tip Off - By The Mock Sports</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#fbbf24">

  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <style>
    .gradient-text {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .glass-effect {
      background: rgba(17, 24, 39, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }
    .card {
      background: linear-gradient(145deg, rgba(31, 41, 55, 0.9), rgba(17, 24, 39, 0.9));
      border: 1px solid rgba(75, 85, 99, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
      border-color: rgba(251, 191, 36, 0.3);
    }
    .stat-card {
      background: linear-gradient(145deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
      border: 1px solid rgba(75, 85, 99, 0.4);
      transition: all 0.3s ease;
    }
    .stat-card:hover {
      border-color: rgba(251, 191, 36, 0.4);
      transform: translateY(-2px);
    }
    .skeleton {
      background: linear-gradient(90deg, rgba(55, 65, 81, 0.3) 25%, rgba(75, 85, 99, 0.3) 50%, rgba(55, 65, 81, 0.3) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .badge {
      background: rgba(217, 119, 6, 0.2);
      border: 1px solid rgba(251, 191, 36, 0.3);
    }
    .countdown-closed {
      background: rgba(220, 38, 38, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 flex flex-col min-h-screen">
  <!-- Navigation -->
 <!-- Navigation -->
<nav class="sticky top-0 z-50 glass-effect">

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-4">
      <div class="flex items-center">
        <img src="images/logo.png" alt="Logo" class="h-8 w-8 mr-2" style="object-fit: contain;" />
        <h1 class="text-xl font-bold gradient-text">The Great Spring Tip Off</h1>
      </div>
      <div class="flex items-center space-x-4">
        <!-- Mobile menu button -->
        <button class="md:hidden" onclick="toggleMenu()">
          <i data-feather="menu" class="h-6 w-6 text-gray-200"></i>
        </button>
        <!-- Desktop menu -->
        <div class="hidden md:flex space-x-6">
          <a href="dark.html" class="text-gray-300 hover:text-yellow-400 transition">Home</a>
          <a href="tipdark.html" class="text-gray-300 hover:text-yellow-400 transition">Tip Now</a>
          <a href="leaderboarddark.html" class="text-gray-300 hover:text-yellow-400 transition">Leaderboard</a>
          <a href="resultsdark.html" class="text-gray-300 hover:text-yellow-400 transition">Results</a>
          <a href="faq.html" class="text-gray-300 hover:text-yellow-400 transition">FAQ</a>
          <a href="prizesdark.html" class="text-gray-300 hover:text-yellow-400 transition">Prizes</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile Menu -->
  <div id="mobileMenu" class="hidden md:hidden glass-effect px-4 py-2 space-y-2">
    <a href="dark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Home</a>
    <a href="tipdark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Tip Now</a>
    <a href="leaderboarddark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Leaderboard</a>
    <a href="resultsdark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Results</a>
    <a href="faq.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">FAQ</a>
    <a href="prizesdark.html" class="block py-2 text-gray-300 hover:text-yellow-400 transition">Prizes</a>
  </div>
</nav>


  <!-- Main Content -->
  <main class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow">
    <!-- Welcome Section -->
<section class="mb-10" data-aos="fade-up">
  <div class="card rounded-2xl shadow-2xl p-8 md:p-10 relative overflow-hidden">
    <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-yellow-600/10 to-transparent rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-amber-600/10 to-transparent rounded-full blur-3xl"></div>
    <div class="relative z-10">
      <h2 class="text-2xl md:text-4xl font-bold mb-2">
        Welcome back, <span id="userName" class="gradient-text">Guest</span>!
      </h2>
      <p class="text-base text-gray-300">Ready to make your picks for the upcoming races?</p>
    </div>
  </div>
</section>


    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-5 mb-10">
      <div class="stat-card rounded-xl shadow-lg p-6" data-aos="fade-up">
        <div class="flex items-center justify-between mb-3">
          <div class="bg-gradient-to-br from-yellow-500/20 to-amber-600/20 p-3 rounded-xl border border-yellow-500/30">
            <i data-feather="award" class="h-7 w-7 text-yellow-400"></i>
          </div>
          <span id="leaderboard-rank" class="text-4xl font-bold text-yellow-400">-</span>
        </div>
        <h3 class="text-base font-semibold text-gray-200 mb-1">Leaderboard Rank</h3>
        <p class="text-sm text-gray-400">Your current position</p>
      </div>

      <div class="stat-card rounded-xl shadow-lg p-6" data-aos="fade-up" data-aos-delay="100">
        <div class="flex items-center justify-between mb-3">
          <div class="bg-gradient-to-br from-green-500/20 to-emerald-600/20 p-3 rounded-xl border border-green-500/30">
            <i data-feather="flag" class="h-7 w-7 text-green-400"></i>
          </div>
          <span id="wins-count" class="text-4xl font-bold text-green-400">0</span>
        </div>
        <h3 class="text-base font-semibold text-gray-200 mb-1">Total Wins</h3>
        <p class="text-sm text-gray-400">Races you've picked correctly</p>
      </div>

      <div class="stat-card rounded-xl shadow-lg p-6" data-aos="fade-up" data-aos-delay="200">
        <div class="flex items-center justify-between mb-3">
          <div class="bg-gradient-to-br from-blue-500/20 to-cyan-600/20 p-3 rounded-xl border border-blue-500/30">
            <i data-feather="zap" class="h-7 w-7 text-blue-400"></i>
          </div>
          <span id="points" class="text-4xl font-bold text-blue-400">0</span>
        </div>
        <h3 class="text-base font-semibold text-gray-200 mb-1">Total Points</h3>
        <p class="text-sm text-gray-400">Accumulated score</p>
      </div>
    </div>

    <!-- Upcoming Races -->
    <section data-aos="fade-up">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl md:text-3xl font-bold gradient-text">Upcoming Races</h2>
      </div>
      <div id="raceGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
        <!-- Loading skeletons -->
        <div class="card rounded-xl shadow-lg overflow-hidden skeleton-card">
          <div class="h-36 skeleton"></div>
          <div class="p-6 space-y-3">
            <div class="h-6 skeleton rounded w-3/4"></div>
            <div class="h-4 skeleton rounded w-1/2"></div>
            <div class="h-10 skeleton rounded mt-4"></div>
          </div>
        </div>
        <div class="card rounded-xl shadow-lg overflow-hidden skeleton-card hidden md:block">
          <div class="h-36 skeleton"></div>
          <div class="p-6 space-y-3">
            <div class="h-6 skeleton rounded w-3/4"></div>
            <div class="h-4 skeleton rounded w-1/2"></div>
            <div class="h-10 skeleton rounded mt-4"></div>
          </div>
        </div>
        <div class="card rounded-xl shadow-lg overflow-hidden skeleton-card hidden lg:block">
          <div class="h-36 skeleton"></div>
          <div class="p-6 space-y-3">
            <div class="h-6 skeleton rounded w-3/4"></div>
            <div class="h-4 skeleton rounded w-1/2"></div>
            <div class="h-10 skeleton rounded mt-4"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-950 border-t border-gray-800 text-gray-400 py-10 mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex flex-col items-center md:items-start">
          <div class="flex items-center mb-2">
            <img src="images/logo.png" alt="Logo" class="h-6 w-6 mr-2" style="object-fit: contain;" />
            <span class="font-semibold text-gray-300">The Mock Sports</span>
          </div>
          <p class="text-sm text-gray-500">&copy; 2026 All rights reserved.</p>
        </div>
        <div class="flex space-x-6">
          <a href="https://x.com/themocksports" target="_blank" rel="noopener noreferrer" class="hover:text-yellow-400 transition-colors duration-200" aria-label="Follow us on X">
            <i data-feather="twitter" class="h-5 w-5"></i>
          </a>
          <a href="https://facebook.com/TheMockSports" target="_blank" rel="noopener noreferrer" class="hover:text-yellow-400 transition-colors duration-200" aria-label="Follow us on Facebook">
            <i data-feather="facebook" class="h-5 w-5"></i>
          </a>
          <a href="https://instagram.com/themocksports" target="_blank" rel="noopener noreferrer" class="hover:text-yellow-400 transition-colors duration-200" aria-label="Follow us on Instagram">
            <i data-feather="instagram" class="h-5 w-5"></i>
          </a>
        </div>
      </div>
    </div>
  </footer>

 <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, doc, getDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    const { DateTime } = luxon;

    const firebaseConfig = {
      apiKey: "AIzaSyCrgNrA4n62hg1U3ujZMRCOYcbLcwT77ZA",
      authDomain: "tmstipping.firebaseapp.com",
      projectId: "tmstipping",
      storageBucket: "tmstipping.appspot.com",
      messagingSenderId: "401677933527",
      appId: "1:401677933527:web:2312ad4ef69aef6551c992",
      measurementId: "G-GXLRCHV687"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const HOME_STATS_CACHE_KEY = "tmstipping:homeStats";

    function applyCachedHomeStats() {
      try {
        const raw = localStorage.getItem(HOME_STATS_CACHE_KEY);
        if (!raw) return;
        const cached = JSON.parse(raw);
        if (!cached) return;

        if (cached.userName) {
          document.getElementById("userName").textContent = cached.userName;
        }
        if (cached.rank !== undefined) {
          document.getElementById("leaderboard-rank").textContent = cached.rank;
        }
        if (cached.wins !== undefined) {
          document.getElementById("wins-count").textContent = cached.wins;
        }
        if (cached.points !== undefined) {
          document.getElementById("points").textContent = cached.points;
        }
      } catch (error) {
        localStorage.removeItem(HOME_STATS_CACHE_KEY);
      }
    }

    function saveHomeStatsToCache({ userName, rank, wins, points }) {
      localStorage.setItem(
        HOME_STATS_CACHE_KEY,
        JSON.stringify({ userName, rank, wins, points, updatedAt: Date.now() })
      );
    }

    applyCachedHomeStats();

    // --- Leaderboard data ---
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const snap = await getDoc(doc(db, "leaderboard", user.uid));
        if (snap.exists()) {
          const data = snap.data();
          const userName = data.teamName || user.displayName || user.email || "Guest";
          const rank = data.rank || "-";
          const wins = data.winners || 0;
          const points = data.points?.toFixed(2) || 0;

          document.getElementById("userName").textContent = userName;
          document.getElementById("leaderboard-rank").textContent = rank;
          document.getElementById("wins-count").textContent = wins;
          document.getElementById("points").textContent = points;

          saveHomeStatsToCache({ userName, rank, wins, points });
        }
      } else {
        document.getElementById("userName").textContent = "Guest";
        document.getElementById("leaderboard-rank").textContent = "-";
        document.getElementById("wins-count").textContent = 0;
        document.getElementById("points").textContent = 0;
        localStorage.removeItem(HOME_STATS_CACHE_KEY);
      }
    });

    // --- Races data ---
    async function loadRaces() {
      const raceGrid = document.getElementById("raceGrid");
      raceGrid.innerHTML = "";
      const racesSnap = await getDocs(collection(db, "races"));

      const nowSydney = DateTime.now().setZone("Australia/Sydney");
      const races = [];

      racesSnap.forEach(docSnap => {
        races.push({ id: docSnap.id, ...docSnap.data() });
      });

      races.sort((a, b) => {
        return DateTime.fromISO(`${a.date}T${a.time}`, { zone: "Australia/Sydney" }) -
               DateTime.fromISO(`${b.date}T${b.time}`, { zone: "Australia/Sydney" });
      });

      let shown = 0;
      for (const race of races) {
        const dt = DateTime.fromISO(`${race.date}T${race.time}`, { zone: "Australia/Sydney" });
        if (dt < nowSydney) continue; // skip past races
        shown++;

        // --- Determine photo ---
        let photo = "default.jpg";
        const raceName = race.name?.toLowerCase() || "";
        if (raceName.includes("valley")) photo = "valley.jpg";
        else if (raceName.includes("randwick")) photo = "randwick.jpg";
        else if (raceName.includes("rosehill")) photo = "rosehill.jpg";
        else if (raceName.includes("caulfield")) photo = "caulfield.jpg";
        else if (raceName.includes("flemington")) photo = "flemington.jpg";

        // --- Countdown target (5 mins before start) ---
        const targetTime = dt.minus({ minutes: 5 }).toMillis();
        const timerId = `timer-${race.id}`;
        const isClosed = targetTime < DateTime.now().toMillis();
        const previewUrl = (race.preview || "").trim();
        const hasPreview = previewUrl.length > 0;

        const card = document.createElement("div");
        card.className = "card rounded-xl shadow-lg overflow-hidden";

        card.innerHTML = `
          <div class="h-36 relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/50 to-transparent z-10"></div>
            <img src="images/${photo}" alt="Race track" class="w-full h-full object-cover" onerror="this.src='images/default.jpg'">
          </div>
          <div class="p-6">
            <div class="flex justify-between items-start mb-3">
              <div class="flex-1">
                <h3 class="text-lg font-bold text-gray-100 mb-1 line-clamp-2">${race.name}</h3>
                <div class="flex items-center text-sm text-gray-400">
                  <i data-feather="clock" class="h-4 w-4 mr-1"></i>
                  <span>${dt.toFormat("EEE, LLL d • h:mm a")}</span>
                </div>
              </div>
              <span class="badge text-yellow-300 px-2.5 py-1 rounded-lg text-xs font-medium whitespace-nowrap ml-2">${race.type || "Open"}</span>
            </div>
            <div class="mb-4">
              <div id="${timerId}" class="${isClosed ? 'countdown-closed' : 'bg-gray-800/50 border border-gray-700'} text-center py-2 rounded-lg text-sm font-semibold ${isClosed ? '' : 'text-yellow-400'}"></div>
            </div>
            <div class="space-y-2">
              <a href="tipdark.html?raceId=${race.id}" 
                 class="block w-full text-center bg-gradient-to-r from-yellow-500 to-amber-500 text-gray-900 font-semibold py-2.5 rounded-lg hover:from-yellow-400 hover:to-amber-400 transition-all duration-200 shadow-lg shadow-yellow-900/30">
                Tip Now
              </a>
              ${hasPreview ? `<a href="${previewUrl}" target="_blank" rel="noopener noreferrer" class="block w-full text-center bg-gradient-to-r from-red-600 to-rose-600 text-white font-semibold py-2.5 rounded-lg hover:from-red-500 hover:to-rose-500 transition-all duration-200 shadow-lg shadow-red-900/30">Preview</a>` : ""}
            </div>
          </div>
        `;
        raceGrid.appendChild(card);

        // Start countdown for this race
        startCountdown(timerId, targetTime);
      }

      if (shown === 0) {
        raceGrid.innerHTML = `
          <div class="col-span-full card rounded-xl p-12 text-center">
            <div class="max-w-sm mx-auto">
              <div class="w-16 h-16 mx-auto mb-4 bg-gray-800 rounded-full flex items-center justify-center">
                <i data-feather="calendar" class="h-8 w-8 text-gray-500"></i>
              </div>
              <h3 class="text-lg font-semibold text-gray-300 mb-2">No Upcoming Races</h3>
              <p class="text-gray-500 text-sm">Check back soon for new racing opportunities!</p>
            </div>
          </div>
        `;
        feather.replace();
      }
    }

    // --- Countdown helper ---
    function startCountdown(elId, targetTime) {
      const el = document.getElementById(elId);
      if (!el) return;

      function update() {
        const now = DateTime.now().toMillis();
        const diff = targetTime - now;
        if (diff <= 0) {
          el.textContent = "⛔ Tipping Closed";
          el.className = "countdown-closed text-center py-2 rounded-lg text-sm font-semibold";
          clearInterval(timer);
          return;
        }
        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((diff % (1000 * 60)) / 1000);
        
        let timeText = "Closes in: ";
        if (d > 0) timeText += `${d}d `;
        if (h > 0 || d > 0) timeText += `${h}h `;
        timeText += `${m}m ${s}s`;
        el.textContent = timeText;
      }

      update(); // initial
      const timer = setInterval(update, 1000);
    }

    loadRaces();

    // --- UI setup ---
    AOS.init({ duration: 800, once: true, offset: 50 });
    
    function toggleMenu() {
      document.getElementById('mobileMenu').classList.toggle('hidden');
    }
    window.toggleMenu = toggleMenu;

    // Initialize feather icons
    feather.replace();
    
    // Re-initialize feather icons after dynamic content loads
    setTimeout(() => feather.replace(), 100);
  </script>
</body>
</html>
